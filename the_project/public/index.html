<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Simple SPA</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    nav {
      background: #222;
      padding: 10px;
    }
    nav a {
      color: white;
      margin-right: 15px;
      text-decoration: none;
      cursor: pointer;
    }
    nav a:hover {
      text-decoration: underline;
    }
    #app {
      padding: 20px;
    }
  </style>
</head>
<body>

  <nav>
    <a onclick="navigate('home')">Home</a>
    <a onclick="navigate('about')">About</a>
    <a onclick="navigate('contact')">Contact</a>
  </nav>
  
  <div id="app"></div>
  
  <img src="/image" style="max-width:100%;" />
  
  <form id="todo-form">
      <input
          type="text"
          id="todo-title"
          placeholder="Enter a todo (max 140 chars)"
          maxlength="140"
      />
      <br />
      <button type="submit">Add Todo</button>
  </form>

  <h2>Todos</h2>
  <ul id="todo-list"></ul>

  <script>
    const routes = {
      home: `
        <h1>Home</h1>
        <p>Welcome to this simple Single Page Application.</p>
      `,
      about: `
        <h1>About</h1>
        <p>This SPA is built using plain JavaScript.</p>
      `,
      contact: `
        <h1>Contact</h1>
        <p>Email us at example@email.com</p>
      `
    };

    function navigate(route) {
      document.getElementById("app").innerHTML = routes[route];
      history.pushState({}, "", "#" + route);
    }

    window.onpopstate = () => {
      const route = location.hash.replace("#", "") || "home";
      document.getElementById("app").innerHTML = routes[route];
    };

    document.getElementById('todo-form').addEventListener('submit', e => {
      e.preventDefault();
      const titleInput = document.getElementById('todo-title');
      const title = titleInput.value.trim();
      if (title) {
        createTodo(title);
        titleInput.value = '';
      }
    });

    const apiUrl = `${window.location.origin}/todos`;

    async function createTodo(title) {
      try {
        const res = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ title, done: false })
        });

        if (!res.ok) throw new Error('Failed to create todo');

        await fetchTodos(); // refresh the list
      } catch (err) {
        console.error(err);
      }
    }


    // Fetch todos from backend and populate the list
    async function fetchTodos() {
      try {
        const res = await fetch(apiUrl);
        const todos = await res.json();

        const list = document.getElementById('todo-list');
        list.innerHTML = ''; // clear current list

        todos.forEach(todo => {
          const li = document.createElement('li');
          li.textContent = `${todo.title} ${todo.done ? "(done)" : ""}`;
          list.appendChild(li);
        });
      } catch (err) {
        console.error('Failed to fetch todos', err);
      }
    }

    // Load default route
    navigate("home");
    fetchTodos();
  </script>

</body>
</html>